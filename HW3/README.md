# 计算物理B第三次作业

PB20511896 王金鑫

## 使用说明

### 文件说明

- `main.py` : 主程序，包括一个随机游走产生的结果的例子和 $\delta-RealWalk$ 关系演示。在这里默认取$\mu=0, \sigma=1$

> `RealWalk`为一次随机游走的实际次数

- `RandomWalk.py` : 和随机游走有关的函数

### 第三方库说明

- `matplotlib.pyplot`：用于绘制直方图
- `random.uniform()`：用于产生均匀随机数。
- `random.seed()`：更改随机数种子
- `math`：调用相关数学常数 (例如：`math.pi` $\rightarrow \pi$) 和初等函数。
- `time()`：调用当前时间作为随机数种子。

### 函数说明

> 源代码中均有注释，在这里挑选部分进行展示

- `GaussFunc(x, mu, sigma) `： 计算Gauss分布密度函数的值。

  > Gauss分布密度函数：$f(x) = \frac{1}{\sqrt{2\pi} \sigma} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$

- `Gauss_Metro(nSample, mu=0, sigma=1, delta=1, SelfAdopt=0) `： 利用Metropolis随机游走方法进行Gauss分布采样

  - 参数说明

    `nSample`: 在$SelfAdopt=0$ 时，作为采样的次数；

    ​			 在$SelfAdopt\neq 0$ 时，作为采样次数的上限，避免死循环或长时间无法跳出循环。

    `delta`: 游走的步长

    `SelfAdopt`: 等于0时，采用规定次数的采样；

    ​				   不等于0时，采用“平衡条件”（$\langle (x-\mu)^2 \rangle \approx \sigma^2$）作为停止游走的判据。同时为防止长时间无法跳出循环，需要设置一个采样上限，在这里将`nSample`作为上限的数值。

    >  对于某些delta值，即使误差放到 $abs(\langle (x-\mu)^2 \rangle - \sigma^2) \le 0.5$ ，在采样了$10^6$步后仍然没有达到平衡条件。

  - 内部参数说明

    `NSample`: 实际采样的次数。

    `NWalk`: 随机游走的实际数目

    `VarX`: $(x-\mu)^2$ 的均值 $\langle (x-\mu)^2 \rangle$

    `xList`: 产生的随机数列表
    
  - 返回参数
  
    `xList, NWalk/NSample, VarX, NWalk, NSample`
  
    其中`NWalk/NSample`为接受度(Acceptance)，即$\frac{随机游走的次数}{采样的次数}$


### 运行说明

打开main.py，

- 事例部分：可修改`mu, sigma, delta`的数值来得到不同的Gauss分布密度函数。采样的次数默认为$10^6$， 默认`SelfAdopt`=0，但都可自行修改。最终的结果会将理论曲线和产生的分布进行比较，同时展示`VarX`和`Acceptance`的数值。

- 探究最大试探步长$\delta$和达到平衡分布的时间部分：在这里用采样的次数来表示达到平衡分布的时间。取一系列$\delta$进行随机游走，得到随机游走的次数，做出两者关系曲线。可以通过更改相关参数来实现不同程度的探究。这里的delta序列为一个等差数列。

  `deltaMid`：序列的中心值

  `deltaNum`：序列中元素的个数

  `deltaStep`：相邻元素的差值（间隔）

### 注意事项

- 由于没有增加限制$\delta$取值的部分，因此需要人为地控制$\delta$序列的最小值不能小于0。
- 经测试，在$\sigma=1$的情况下，若$\delta$的值在2及以上，随机游走达到“平衡条件”所需的步数最多要超过$1\times 10^7$，因此不建议将游走次数的上限设的过高。
- 在第一次游走时可能没有接受，使检验是否“平衡”时分母出现0。同时在游走次数不多时也可能达到“平衡条件”。但这些都不是我们想要的，因此增加了一个游走步数下限，在游走步数达到这个下限之后才开始检验是否达到“平衡条件”。

## 运行结果

$\delta=2$ 时随机游走$10^6$步的结果如图1所示。

| ![Exam](figs\Exam.png)                   |
| ---------------------------------------- |
| 图1. $\delta=2$ 时随机游走$10^6$步的结果 |

将误差放到 $abs(\langle (x-\mu)^2 \rangle - \sigma^2) \le 0.1$，运行结果如图2~9所示。其中为了检验结果的稳定性，对同一类参数进行了多次实验。

图3和图4是`deltaMid, deltaNum, deltaStep = 4, 200, 0.01`条件下的两次实验，图5~7是`deltaMid, deltaNum, deltaStep = 2, 200, 0.01`条件下的三次实验。从中可以看出同一条件下的结果比较相近，因此可认为实验的结果较为稳定。尽管图7中最大步数超过$5\times 10^6$而图5和图6都在14000左右，但是从分布形状上来看，三者还是差不多的。

从图2~4可看出当$\delta > 3$时达到平衡所需的步数十分不稳定，且游走的步数最高都超过了$10^5$甚至$5\times10^5$。因此 **$\delta$大于3的取值都不合理**。

| ![](figs\5-100-0.1.png)                                      | ![](figs\4-200-0.01.png)                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 图2. `deltaMid, deltaNum, deltaStep = 5, 100, 0.1`结果       | 图3. `deltaMid, deltaNum, deltaStep = 4, 200, 0.01`第一次结果 |
| ![](figs\4-200-0.01b.png)                                    | ![](figs\2-200-0.01.png)                                     |
| 图4. `deltaMid, deltaNum, deltaStep = 4, 200, 0.01`第二次结果 | 图5. `deltaMid, deltaNum, deltaStep = 2, 200, 0.01`第一次结果 |
| ![](figs\2-200-0.01b.png)                                    | ![](figs\2-200-0.01c.png)                                    |
| 图6. `deltaMid, deltaNum, deltaStep = 2, 200, 0.01`第二次结果 | 图7. `deltaMid, deltaNum, deltaStep = 2, 200, 0.01`第三次结果 |
| ![1-100-0.01](figs\1-100-0.01.png)                           | ![1-100-0.01b](figs\1-100-0.01b.png)                         |
| 图8. `deltaMid, deltaNum, deltaStep = 1, 100, 0.01`第二次结果 | 图9. `deltaMid, deltaNum, deltaStep = 1, 100, 0.01`第二次结果 |

图2~9的$\delta$下限为100，因此图中较低的步数数量级过小，达到平衡应看作是一种偶然。因此对于图5~9，还需进一步研究。将下限设为1000，得到的结果如图10、11所示。再将下限设为10000，探究2.0附近的情况，如图12所示。

| ![1000-1](figs\1000-1.png)        | ![1000-2](figs\1000-2.png)                   |
| --------------------------------- | -------------------------------------------- |
| 图10. 下限改为1000后原图8~9的结果 | 图11. 下限改为1000后原图5~7的结果            |
| ![10000-2](figs\10000-2.png)      | 图12. 下限改为1000后在$\delta$=2.0附近的结果 |

从图10~12中可以看出关系较为复杂，没有特点的规律。但是可以从中找到一些合适的$\delta$取值，比如2.00和1.98等，即那些有波动但很小的部分。
