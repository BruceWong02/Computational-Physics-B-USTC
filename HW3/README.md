# 计算物理B第三次作业

PB20511896 王金鑫

## 使用说明

### 文件说明

- `main.py` : 主程序，包括一个随机游走产生的结果的例子和 $\delta-RealWalk$ 关系演示。在这里默认取$\mu=0, \sigma=1$

> `RealWalk`为一次随机游走的实际次数

- `RandomWalk.py` : 和随机游走有关的函数

### 第三方库说明

- `matplotlib.pyplot`：用于绘制直方图
- `random.uniform()`：用于产生均匀随机数。
- `random.seed()`：更改随机数种子
- `math`：调用相关数学常数 (例如：`math.pi` $\rightarrow \pi$) 和初等函数。
- `time()`：调用当前时间作为随机数种子。

### 函数说明

> 源代码中均有注释，在这里挑选部分进行展示

- `GaussFunc(x, mu, sigma) `： 计算Gauss分布密度函数的值。

  > Gauss分布密度函数：$f(x) = \frac{1}{\sqrt{2\pi} \sigma} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$

- `Gauss_Metro(nSample, mu=0, sigma=1, delta=1, SelfAdopt=0) `： 利用Metropolis随机游走方法进行Gauss分布采样

  - 参数说明

    `nSample`: 在$SelfAdopt=0$ 时，作为采样的次数；

    ​			 在$SelfAdopt\neq 0$ 时，作为采样次数的上限，避免死循环或长时间无法跳出循环。

    `delta`: 游走的步长

    `SelfAdopt`: 等于0时，采用规定次数的采样；

    ​				   不等于0时，采用“平衡条件”（$\langle (x-\mu)^2 \rangle \approx \sigma^2$）作为停止游走的判据。同时为防止长时间无法跳出循环，需要设置一个采样上限，在这里将`nSample`作为上限的数值。

    >  对于某些delta值，即使误差放到 $abs(\langle (x-\mu)^2 \rangle - \sigma^2) \le 0.5$ ，在采样了$10^6$步后仍然没有达到平衡条件。

  - 内部参数说明

    `NSample`: 实际采样的次数。

    `NWalk`: 随机游走的实际数目

    `VarX`: $(x-\mu)^2$ 的均值 $\langle (x-\mu)^2 \rangle$

    `xList`: 产生的随机数列表
    
  - 返回参数
  
    `xList, NWalk/NSample, VarX, NWalk, NSample`
  
    其中`NWalk/NSample`为接受度(Acceptance)，即$\frac{随机游走的次数}{采样的次数}$


### 运行说明

打开main.py，

- 事例部分：可修改`mu, sigma, delta`的数值来得到不同的Gauss分布密度函数。采样的次数默认为$10^6$， 默认`SelfAdopt`=0，但都可自行修改。最终的结果会将理论曲线和产生的分布进行比较，同时展示`VarX`和`Acceptance`的数值。

- 探究最大试探步长$\delta$和达到平衡分布的时间部分：在这里用采样的次数来表示达到平衡分布的时间。取一系列$\delta$进行随机游走，得到采样的次数，做出两者关系曲线。可以通过更改相关参数来实现不同程度的探究。这里的delta序列为一个等差数列。

  `deltaMid`：序列的中心值

  `deltaNum`：序列中元素的个数

  `deltaStep`：相邻元素的差值（间隔）

### 注意事项

- 由于没有增加限制$\delta$取值的部分，因此需要人为地控制$\delta$序列的最小值不能小于0。
- 经测试，在$\sigma=1$的情况下，若$\delta$的值在2及以上，随机游走达到“平衡条件”所需的步数最多要超过$1\times 10^7$，因此不建议将游走次数的上限设的过高。
- 在第一次采样时可能没有接受该点，使检验是否“平衡”时分母出现0。同时在游走次数不多时也可能达到“平衡条件”。但这些都不是我们想要的，因此增加了一个采样步数下限，在采样步数达到这个下限之后才开始检验是否达到“平衡条件”。
- 为防止样本方差偶然地达到平衡条件，在游走过程中限制了只有连续10次的游走都满足“平衡条件”才能算满足平衡。

## 运行结果

$\delta=2.08$ 时采样$10^6$次的结果如图1所示。

| ![Exam](figs\Exam.png)                  |
| --------------------------------------- |
| 图1. $\delta=2.08$ 时采样$10^6$次的结果 |

将误差放到 $abs(\langle (x-\mu)^2 \rangle - \sigma^2) \le 0.05$，采样下限为200次，采样上限为$10^6$次，运行结果如图2~5所示。

从图中来看，当 $\delta$ 在0.1~0.5和1.6~2.4之间时会容易收敛，其它情况下很难达到平衡，尤其是当$\delta>3$时。

| ![](figs\1-198-001.png)                                 | ![](figs\2-150-001.png)                                 |
| ------------------------------------------------------- | ------------------------------------------------------- |
| 图2. `deltaMid, deltaNum, deltaStep = 1, 198, 0.01`结果 | 图3. `deltaMid, deltaNum, deltaStep = 2, 150, 0.01`结果 |
| ![](figs\3-150-001.png)                                 | ![](figs\5-500-001.png)                                 |
| 图4. `deltaMid, deltaNum, deltaStep = 3, 150, 0.01`结果 | 图5. `deltaMid, deltaNum, deltaStep = 5, 500, 0.01`结果 |

由于在2.0附近的收敛性都较好，因此在2.0附近再作更细致的研究，如图6、7所示

| ![](figs\2-1000-0001.png)                                 | ![](figs\2-400-0001.png)                                 |
| --------------------------------------------------------- | -------------------------------------------------------- |
| 图6. `deltaMid, deltaNum, deltaStep = 2, 1000, 0.001`结果 | 图7. `deltaMid, deltaNum, deltaStep = 2, 400, 0.001`结果 |

从图6和图7可看出 $\delta$ 在1.8~2.2的收敛性都较好。进一步探究，将误差放至 $abs(\langle (x-\mu)^2 \rangle - \sigma^2) \le 0.005$，结果如图8所示。

| ![](figs\2-400-0001b.png)                                    |
| ------------------------------------------------------------ |
| 图8. 误差缩小后，`deltaMid, deltaNum, deltaStep = 2, 400, 0.001`结果 |

从图中可看出只有在2.00~2.10附近的值收敛性较好。进一步考虑2.10附近，结果如图9、图10所示。

| ![](figs\210-100-0001.png)                                   | ![](figs\210-400-00001.png)                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 图9. 误差缩小后，`deltaMid, deltaNum, deltaStep = 2.1, 100, 0.001`结果 | 图10. 误差缩小后，`deltaMid, deltaNum, deltaStep = 2.1, 400, 0.0001`结果 |

从图中可看出在2.08~2.10之间的$\delta$对应的收敛性会较好，尤其是2.085和2.1058附近的值。

总的来看，随 $\delta$ 增大，达到平衡所需时间会不断地波动。由上述结果可知，$\delta$ 取值在2.08和2.1058附近时达到平衡所需时间较短，因此这些取值比较合理。
